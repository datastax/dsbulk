# Workflow Engine Configuration

Settings can be specified in [HOCON] format, or in flattened properties format.

[HOCON]: https://github.com/typesafehub/config/blob/master/HOCON.md

For example, to set the protocol version to use, you can either use the following HOCON format:

```hocon
driver {
  protocol {
    version = V4
  }
}
```

Or alternatively, you can use the following properties format:

```hocon
driver.protocol.version=V4
```
 
## Available settings

The following options can be configured:

* ` driver`

    Driver-specific settings.
 
    * `contact-points` [string list]
    
         The contact points to use for the initial connection to the cluster
         This must be a list of strings with each contact point specified as "host:port". If the host is
         a DNS name that resolves to multiple A-records, all the corresponding addresses will be used.
         Do not use "localhost" as the host name (since it resolves to both IPv4 and IPv6 addresses on
         some platforms).
         Note that all nodes in a cluster must share the same port.
         Defaults to `["127.0.0.1:9042"]`.

    * `protocol`
    
        Protocol-specific settings.

        * `version` [enum]
       
            The native protocol version to use.
            Valid values are: `V3`, `V4`, `DSE_V1`.
            This option is not required. If it is absent, the driver will negotiate it.

        * `compression` [enum]
        
            The compression algorithm to use.
            Valid values are: `NONE`, `LZ4`, `SNAPPY`.
            Defaults to `LZ4`.

    * `pooling`
    
        Pooling-specific settings. 
    
        The driver maintains a connection pool to each node, 
        according to the distance assigned to it by the load balancing policy. 
        If the distance is `IGNORED`, no connections are maintained.

        * `local`
        
            Pooling settings for nodes at `LOCAL` distance.

            * `connections` [int]
         
                The number of connections in the pool.
                Defaults to 1.

            * `requests` [int]
                
                The maximum number of requests that can be executed concurrently on a connection.
                This must be between 1 and 32768.
                Defaults to 32768.

        * `remote`
        
            Pooling settings for nodes at `REMOTE` distance.

            * `connections` [int]
                
                The number of connections in the pool.
                Defaults to 1.

            * `requests = 1024` [int]
                
                The maximum number of requests that can be executed concurrently on a connection.
                This must be between 1 and 32768.
                Defaults to 1024.

        * `heartbeat` [duration]
               
           The heartbeat interval. If a connection stays idle for that duration (no reads), the driver
           sends a dummy message on it to make sure it's still alive. If not, the connection is
           trashed and replaced.
           Defaults to 30 seconds.

    * `query`
    
        Query-related settings.

        * `consistency` [enum]

            The consistency level to use for both reads and writes.
            Allowed values are:
            `ANY`, `LOCAL_ONE`, `ONE`, `TWO`, `THREE`, `LOCAL_QUORUM`, `QUORUM`, `EACH_QUORUM`, `ALL`.
            Defaults to `LOCAL_ONE`.

        * `serial-consistency` [enum]

            The serial consistency level to use for writes.
            The allowed values are: `SERIAL` and `LOCAL_SERIAL`.
            Only applicable if the data is inserted using lightweight transactions,
            ignored otherwise.
            Defaults to `LOCAL_SERIAL`.

        * `fetch-size` [int]

            The page size. This controls how many rows will be retrieved simultaneously in a single
            network round trip (the goal being to avoid loading too many results in memory at the same
            time).
            Only applicable in read scenarios, ignored otherwise.
            Defaults to 5000.

        * `idempotence` [boolean]
        
           The default idempotence of statements generated by the loader.
           Defaults to `true`.

    * `socket`
    
        Socket-related settings.

        * `read-timeout` [duration]

            How long the driver waits for a request to complete. This is a global limit on the duration
            of a session.execute() call, including any internal retries the driver might do.

    * `timestamp-generator` [string]
    
        The fully-qualified class name of the timestamp generator to use.
        
        Built-in options are:
        
        - AtomicTimestampGenerator: timestamps are guaranteed to be unique across all client threads.
        - ThreadLocalTimestampGenerator: timestamps that are guaranteed to be unique within each
        thread only.
        - ServerSideTimestampGenerator: do not generate timestamps, let the server assign them.
        
        Defaults to `com.datastax.driver.core.AtomicMonotonicTimestampGenerator`.

    * `address-translator` [string]
    
        The fully-qualified class name of the address translator to use.
        
        This is only needed if the nodes are not directly reachable from the driver (for example, the
        driver is in a different network region and needs to use a public IP, or it connects through
        a proxy).
        
        Defaults to `com.datastax.driver.core.policies.IdentityTranslator`.

    * `policy`
    
        Settings for various driver policies.

        * `retry` [string]

            The fully-qualified class name of the `RetryPolicy` implementation to use.
            Defaults to `com.datastax.driver.core.policies.DefaultRetryPolicy`.

        * `lbp` [string]

            The fully-qualified class name of the `LoadBalancingPolicy` implementation to use.
            Defaults to `com.datastax.driver.core.policies.RoundRobinPolicy`.

        * `specexec` [string]

            The fully-qualified class name of the `SpeculativeExecutionPolicy` implementation to use.
            Defaults to `com.datastax.driver.core.policies.NoSpeculativeExecutionPolicy`.

* `batch`

    Batch-specific settings.
    These settings control how the workflow engine
    groups together statements before writing them.
    Only applicable for write operations, ignored otherwise.
    See `com.datastax.loader.executor.api.batch.StatementBatcher` for more information.

    * `mode` [enum]
    
        The grouping mode.
        Valid values are:
        - `PARTITION_KEY` : Groups together statements that share the same partition key. This is the default mode, and
                            the preferred one.
        - `REPLICA_SET`   : Groups together statements that share the same replica set. This mode might yield better
                            results for small clusters and lower replication factors, but tends to perform equally well
                            or even worse than `PARTITION_KEY` for larger clusters or high replication factors.
        Defaults to `PARTITION_KEY`.

    * `sorted` [boolean]

        Whether the upstream is already sorted by grouping key or not.
        Defaults to `false`.
        This should only be set to `true` if the upstream is guaranteed to be sorted,
        otherwise the batching might not function properly.
        If in doubt, leave this settings to `false`.

    * `buffer-size` [int]

        The buffer size to use when batching.
        Defaults to 1000.

* `executor`

    Executor-specific settings.

    * `max-threads` [string]

        The maximum number of threads to allocate for the executor.
        
        The special syntax "NC" can be used to specify a number of threads
        that is a multiple of the number of available cores, e.g.
        if the number of cores is 8, then 4C = 4 * `8 = 32 threads.`
        
        Defaults to 4C.

    * `max-inflight` [int]
        
        The maximum number of "in-flight" requests. In other words, sets the maximum number of
        concurrent uncompleted futures waiting for a response from the server. 
        
        This acts as a safeguard
        against workflows that generate more requests than they can handle.
        
        Defaults to 1000.
        
        Setting this option to any negative value will disable it.

    * `max-per-second` [int]

        The maximum number of concurrent requests per second. 
        
        This acts as a safeguard against
        workflows that could overwhelm the cluster with more requests than it can handle.
        
        Defaults to 100,000.
        
        Setting this option to any negative value will disable it.

    * `continuous-paging`
    
        Continuous-paging-specific settings.
        Only applicable for reads, and only if this feature is available in the remote cluster, ignored otherwise.

        * `page-unit` [enum]
        
            The unit to use for the page-size setting.
            Possible values are: `ROWS`, `BYTES`.
            Defaults to `ROWS`.

        * `page-size` [int]

            The size of the page. The unit to use
            is determined by the page-unit settings.
            Defaults to 5000 (rows).
      
        * `max-pages` [int]

            The maximum number of pages to retrieve.
            Defaults to 0, which means retrieve all pages available.
      
        * `max-pages-per-second` [int]

            The maximum number of pages per second.
            Defaults to 0, which indicates no limit.

* `log`

    Log and error management settings.

    * `output-directory` [string]

        The output directory where all log files will be stored.
        Log files for a specific run will be located in a sub-directory
        inside the directory specified here. Each run generates
        a sub-directory identified by an "operation ID', which
        is basically a timestamp in the format: `yyyy_MM_dd_HH_mm_ss_nnnnnnnnn`.
        Defaults to `file:.`, which translates into the current directory.

    * `max-threads` [string]

        The maximum number of threads to allocate to log files management.
        The special syntax "NC" can be used to specify a number of threads
        that is a multiple of the number of available cores, e.g.
        if the number of cores is 8, then 4C = 4 * `8 = 32 threads.`
        Defaults to 4.

    * `max-errors` [int]

        The maximum number of errors to tolerate before aborting
        the entire operation.
        Defaults to 100.
        Setting this value to -1 disables this feature (not recommended).

    * `stmt`
    
        Settings controlling how statements are printed to log files.

         * `verbosity` [enum]

            The desired verbosity. Possible values are:
            
            - `ABRIDGED` : only prints basic information in summarized form.
            - `NORMAL`   : prints basic information in summarized form, and the statement's query string,
                        if available. For batch statements, this verbosity level also prints information
                        about the batch's inner statements.
            - `EXTENDED` : prints full information, including the statement's query string, if available,
                        and the statement's bound values, if available. For batch statements, this verbosity
                        level also prints all information available about the batch's inner statements.
            
            Defaults to `EXTENDED`.
        
        * `max-query-string-length` [int]

            The maximum length for a query string. Query strings longer than this value will be truncated.
            Defaults to 500.
            Setting this value to -1 disables this feature (not recommended).

        * `max-bound-values` [int]

            The maximum number of bound values to print. If the statement has more bound values than this limit,
            the exceeding values will not be printed.
            Defaults to 50.
            Setting this value to -1 disables this feature (not recommended).

        * `max-bound-value-length` [int]

            The maximum length for a bound value. Bound values longer than this value will be truncated.
            Defaults to 50.
            Setting this value to -1 disables this feature (not recommended).

        * `max-inner-statements` [int]

            The maximum number of inner statements to print for a batch statement.
            Only applicable for batch statements, ignored otherwise.
            If the batch statement has more children than
            this value, the exceeding child statements will not be printed.
            Defaults to 10.
            Setting this value to -1 disables this feature (not recommended).

* `codec`

    Conversion-specific settings.

    * `locale` [string]

        The locale to use for locale-sensitive conversions.
        Defaults to `en_US` (US English).

    * `time-zone` [string]
        
        The time zone to use for temporal conversions that do not convey any explicit time zone information.
        See the [`java.time.ZoneId`](https://docs.oracle.com/javase/8/docs/api/java/time/ZoneId.html) javadocs for
        information about valid time zone values.
        Defaults to `UTC`.

    * `boolean` [string]
 
        All possible combinations for `true:false`; the first combination is considered the default
        and used when formatting.
        Defaults to `["1:0", "Y:N", "y:n", "T:F", "t:f", "YES:NO", "yes:no", "Yes:No", "TRUE:FALSE", "true:false", "True:False"]`

    * `number ` [string]

        The DecimalFormat pattern to use for String-to-Number conversions.
        For details about the pattern syntax to use,
        See [`java.text.DecimalFormat`](https://docs.oracle.com/javase/8/docs/api/java/text/DecimalFormat.html) 
        javadocs or [this article](https://docs.oracle.com/javase/tutorial/i18n/format/decimalFormat.html).
        Defaults to `#,###.##`.

    * `timestamp` [string]

        The temporal pattern to use for String-to-CQL timestamp conversions.
        This can be either: 
        - A [date-time pattern](https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#patterns);
        - A [pre-defined formatter](https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#formatter) such as 
          [`ISO_DATE_TIME`](https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_DATE_TIME);
        - Or the special value `CQL_DATE_TIME`, which is a special parser that accepts all valid CQL literal formats for
          the timestamp type.
          
        Defaults to `CQL_DATE_TIME`.

    * `date` [string]

        The temporal pattern to use for String-to-CQL date conversions.
        This can be either: 
        - A [date-time pattern](https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#patterns);
        - Or a [pre-defined formatter](https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#formatter) such as 
          [`ISO_LOCAL_DATE`](https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_LOCAL_DATE).
          
        Defaults to `ISO_LOCAL_DATE`.

    * `time` [string]
    
        The temporal pattern to use for String-to-CQL time conversions.
        This can be either: 
        - A [date-time pattern](https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#patterns);
        - Or a [pre-defined formatter](https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#formatter) such as 
          [`ISO_LOCAL_TIME`](https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_LOCAL_TIME).
          
        Defaults to `ISO_LOCAL_TIME`.


* `schema`
    Schema-specific settings.

    * `keyspace` [string]

        The keyspace to connect to.
        If not specified, then the "statement" setting below must be specified.

    * `table` [string]

        The destination table.
        If not specified, then the "statement" setting below must be specified.

    * `statement` [string]

        The INSERT or UPDATE statement to use to load data.
        If not specified, the loader will infer the statement
        based on the destination table's metadata using all availble columns.
        Note that statements *must* use named bound variables;
        positional bound variables will not work.
        Their names usually match those of the columns in the destination table,
        but this is not a strict requirement; it is however required that
        their names match those specified in the mapping. See "mapping" setting below.

    * `null-words` [string list]

        Values (case-sensitive) to map to null in the database when loading data.
        Defaults to empty.

    * `null-to-unset` [boolean]

        Whether or not to map `null` input values to "unset" in the database, meaning don't
        modify a potentially pre-existing value of this field for this row. `null`
        input includes the values from the null-words setting above.
        Note that setting this to false leads to tombstones being created in the database 
        to represent null.
        Defaults to true.

    * `mapping` [map]

        The field-to-column mapping to use.
        If not specified, the loader will apply a strict one-to-one mapping
        between the source fields and the target table.
        If that is not what you want, then you must supply an explicit mapping.
        Mappings should be specified as a HOCON map of the following form:
        - Indexed data sources:
          { 0 = col1, 1 = col2, 2 = col3 }
          where 0, 1, 2, etc. are the zero-based indices of fields in the source data;
          and col1, col2, col3 are bound variable names in the insert statement.
        - Mapped data sources:
          { fieldA = col1, fieldB = col2, fieldC = col3 }
          where fieldA, fieldB, fieldC, etc. are field names in the source data;
          and col1, col2, col3 are bound variable names in the insert statement.
        The exact type of mapping to use depends on the connector being used.
        Some connectors can only produce indexed records; others can only produce
        mapped ones, while others are capable of producing both indexed and mapped
        records at the same time. Refer to the connector's documentation
        to know which kinds of mapping it supports.

* `monitoring`

    Monitoring-specific settings.

    * `report-interval` [duration]
    
        The report interval for the console reporter.
        The console reporter will print useful metrics
        about the ongoing operation at this rate.
        Durations lesser than one second will be rounded up
        to 1 second.
        Defaults to 5 seconds.

    * `rate-unit` [enum]

        The time unit to use when printing throughput rates.
        Valid values: all TimeUnit enum constants.
        Defaults to SECONDS.

    * `duration-unit` [enum]

        The time unit to use when printing latency durations.
        Valid values: all TimeUnit enum constants.
        Defaults to MILLISECONDS.

    * `expected-writes` [long]

        The expected total number of writes.
        This information is optional; if present,
        the console reporter will also print the
        the overall achievement percentage.
        Defaults to -1, which disables this feature.

    * `expected-reads` [long]

        The expected total number of reads.
        This information is optional; if present,
        the console reporter will also print the
        the overall achievement percentage.
        Defaults to -1, which disables this feature.

    * `jmx` [boolean]

        Whether or not to enable JXM reporting.
        Defaults to `true`.
